(function(){"use strict";let o,d,l;console.log("render-worker: started");const i={elements:[],hoveredElement:void 0,state:{type:"idle"}};self.addEventListener("message",e=>{console.log("render-worker: received message",e.data),e.data.type==="init"&&(o=e.data.mousePos,d=e.data.canvas,l=d.getContext("2d"),d.width=e.data.width*e.data.pixelRatio,d.height=e.data.height*e.data.pixelRatio,l.scale(e.data.pixelRatio,e.data.pixelRatio)),e.data.type==="click"&&f(e),e.data.type==="pointerdown"&&y(e.data.x,e.data.y),e.data.type});function f(e){i.state.type==="idle"&&i.elements.push({type:"rect",x:e.data.x-10,y:e.data.y-10,width:20,height:20,stroke:"black",fill:"red"}),i.state.type==="dragging"&&(i.state={type:"idle"})}function h(){if(i.state.type!=="idle"&&i.state.type==="dragging"){const e=o[0]-i.state.x,t=o[1]-i.state.y;i.state.element.x+=e,i.state.element.y+=t,i.state.x=o[0],i.state.y=o[1]}}function y(e,t){i.hoveredElement!==void 0&&(i.state={type:"dragging",element:i.hoveredElement,x:e,y:t})}function g(e,t){const[n,a]=t;e.beginPath(),e.moveTo(n-5,a),e.lineTo(n+5,a),e.moveTo(n,a-5),e.lineTo(n,a+5),e.strokeStyle="black",e.stroke()}function u(e,t){if(i.state.type==="dragging")return i.state.element;for(let n=t.length-1;n>=0;n--){const a=t[n];if(a.type==="rect"&&p(e[0],e[1],a.x,a.y,a.width,a.height))return a}}function p(e,t,n,a,r,w){return e>=n&&e<=n+r&&t>=a&&t<=a+w}function m(e,t,n){const a=new Path2D;if(a.rect(t.x,t.y,t.width,t.height),e.fillStyle=t.fill,e.strokeStyle=t.stroke,e.fill(a),e.stroke(a),n){const r=new Path2D;r.rect(t.x-2,t.y-2,t.width+4,t.height+4),e.strokeStyle="blue",e.lineWidth=1,e.stroke(r)}}function c(e,t){for(const n of t)n.type==="rect"&&m(e,n,n===i.hoveredElement)}function k(){d!==void 0&&(i.hoveredElement=u(o,i.elements),l.clearRect(0,0,d.width,d.height),c(l,i.elements),g(l,o))}function s(e=0){o!==void 0&&(k(),h()),requestAnimationFrame(s)}s(0)})();
